# OpenAI API Configuration
# Required: Your OpenAI API key for authentication
OPENAI_API_KEY=your_api_key_here

# Optional: OpenAI model to use (default: gpt-5.1)
# Recommended: gpt-5.1 for production use
OPENAI_MODEL=gpt-5.1

# Optional: Temperature for model responses (default: 0.7)
# Range: 0.0 to 1.0 (lower = more deterministic, higher = more creative)
# Recommended range: 0.5 to 0.7 for balanced responses
TEMPERATURE=0.7

# ==============================================================================
# Per-Step Configuration
# ==============================================================================
# The Consensus Engine supports per-step model and temperature configuration.
# This allows different models/settings for expansion, review, and aggregation.
# Each step includes its own model, temperature, timeout, and retry configuration.
#
# Version Metadata:
# - All steps use the same schema_version (1.0.0) and prompt_set_version (1.0.0)
# - Version metadata is included in API responses and run outputs
# - See docs/PROMPT_CONTRACTS.md for details on version evolution
# ==============================================================================

# Expansion Step Configuration
# Optional: Model for expansion step (default: gpt-5.1)
EXPAND_MODEL=gpt-5.1

# Optional: Temperature for expansion step (default: 0.7)
# Range: 0.0 to 1.0 (higher encourages more creative proposal generation)
EXPAND_TEMPERATURE=0.7

# Review Step Configuration
# Optional: Model for review step (default: gpt-5.1)
REVIEW_MODEL=gpt-5.1

# Optional: Temperature for review step (default: 0.2)
# Range: 0.0 to 1.0 (lower for more deterministic/consistent reviews)
# Recommended: 0.2 for consistent, focused reviews
REVIEW_TEMPERATURE=0.2

# Aggregation Step Configuration
# Optional: Model for aggregation step (default: gpt-5.1)
# Note: Currently aggregation is deterministic and doesn't use LLM,
# but this is configured for potential future LLM-based aggregation
AGGREGATE_MODEL=gpt-5.1

# Optional: Temperature for aggregation step (default: 0.0)
# Range: 0.0 to 1.0 (0.0 for fully deterministic aggregation)
# Recommended: 0.0 to ensure consistent decision-making
AGGREGATE_TEMPERATURE=0.0

# Persona Configuration
# Optional: Default persona name for reviews (default: GenericReviewer)
DEFAULT_PERSONA_NAME=GenericReviewer

# Optional: Default persona instructions for reviews
# Default: Technical reviewer providing balanced feedback
# DEFAULT_PERSONA_INSTRUCTIONS=You are a technical reviewer...

# Optional: Environment mode (default: development)
# Options: development, production, testing
# Controls logging verbosity and debug features
ENV=development

# Database Configuration
# Optional: Use Cloud SQL Python Connector (default: false)
# Set to true for Cloud Run deployments with Cloud SQL
USE_CLOUD_SQL_CONNECTOR=false

# Optional: Cloud SQL instance connection name (required if USE_CLOUD_SQL_CONNECTOR=true)
# Format: project:region:instance (e.g., my-project:us-central1:my-instance)
# DB_INSTANCE_CONNECTION_NAME=your-project:us-central1:your-instance

# Optional: Database name (default: consensus_engine)
DB_NAME=consensus_engine

# Optional: Database user (default: postgres)
DB_USER=postgres

# Optional: Database password (not used with IAM auth)
# Required for local development or when DB_IAM_AUTH=false
DB_PASSWORD=postgres

# Optional: Database host for local connections (default: localhost)
DB_HOST=localhost

# Optional: Database port for local connections (default: 5432)
DB_PORT=5432

# Optional: Use IAM authentication with Cloud SQL Connector (default: false)
# When true, no password is needed but service account must have cloudsql.client role
DB_IAM_AUTH=false

# Optional: Database connection pool size (default: 5)
# Range: 1-100
DB_POOL_SIZE=5

# Optional: Maximum overflow connections beyond pool size (default: 10)
# Range: 0-100
DB_MAX_OVERFLOW=10

# Optional: Connection pool timeout in seconds (default: 30)
# Range: 1-300
DB_POOL_TIMEOUT=30

# Optional: Connection pool recycle time in seconds (default: 3600)
# Range: 60-7200
# Connections older than this are recycled
DB_POOL_RECYCLE=3600

# Google Cloud Pub/Sub Configuration
# Optional: Google Cloud project ID for Pub/Sub (required for production)
# Example: my-project-123
# PUBSUB_PROJECT_ID=your-project-id

# Optional: Pub/Sub topic name for job queue (default: consensus-engine-jobs)
PUBSUB_TOPIC=consensus-engine-jobs

# Optional: Path to service account JSON credentials file
# Required for local development with real Pub/Sub
# Not needed when using Application Default Credentials (ADC) on Cloud Run/GCE
# PUBSUB_CREDENTIALS_FILE=/path/to/credentials.json

# Optional: Pub/Sub emulator host for local testing (default: none)
# Example: localhost:8085
# When set, the API will connect to the emulator instead of production Pub/Sub
# PUBSUB_EMULATOR_HOST=localhost:8085

# Optional: Enable mock Pub/Sub publisher for testing (default: false)
# When true, uses a no-op publisher that logs messages without sending to Pub/Sub
# Useful for local development without emulator or credentials
PUBSUB_USE_MOCK=false

# ==============================================================================
# API Validation Configuration
# ==============================================================================
# These limits enforce data quality and prevent malformed or malicious inputs.
# All validations occur at the API boundary before LLM calls.
# Exceeding limits results in 422 Unprocessable Entity errors.
#
# Version Tracking:
# - Validation limits are independent of schema/prompt versions
# - Changes to these limits do not require version bumps
# - Limits apply uniformly across all API endpoints under /v1
#
# Tuning Guidelines:
# - Increase limits cautiously to avoid excessive LLM costs
# - Monitor validation error rates to identify if limits are too strict
# - Consider prompt complexity when setting context limits
# - See docs/PROMPT_CONTRACTS.md for version evolution guidance
# ==============================================================================

# Optional: Maximum character length for idea text (default: 10000)
# Range: 100-100000
# Ideas must also contain 1-10 sentences
MAX_IDEA_LENGTH=10000

# Optional: Maximum character length for extra_context (default: 50000)
# Range: 100-500000
# Applies to both string and JSON formats
MAX_EXTRA_CONTEXT_LENGTH=50000

# Optional: Maximum character length for edited_proposal in revision requests (default: 100000)
# Range: 1000-1000000
# Applies to both string and JSON formats
MAX_EDITED_PROPOSAL_LENGTH=100000

# Optional: Maximum character length for edit_notes in revision requests (default: 10000)
# Range: 100-100000
MAX_EDIT_NOTES_LENGTH=10000

# Optional: Minimum number of personas for review (default: 1)
# Range: 1-10
MIN_PERSONA_COUNT=1

# Optional: Maximum number of personas for review (default: 10)
# Range: 1-20
MAX_PERSONA_COUNT=10
